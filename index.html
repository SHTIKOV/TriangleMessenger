<!doctype html>
<html>
  <head>
    <title>Triangle</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  </head>
  <body>
    <div id="app" class="container">
      <div v-for="item in messages" class="row">
        <div class="alert alert-primary col-md-12" 
             role="alert">
          {{ item.autor }}: {{ item.message }} <button @click="item.edit">Edit</button>
        </div>  
      </div>

      <div class="form">
        <div class="form-row align-items-center">
          <div class="col-md-2">
            <label class="sr-only" 
                   for="inlineFormInput">Name</label>
            <input type="text" 
                   class="form-control-plaintext" 
                   id="name" 
                   v-model="name">
          </div>
          <div class="col-md-10">
            <label class="sr-only" 
                   for="inlineFormInputGroup">Message</label>
            <div class="input-group">
              <input type="textarea" 
                     class="form-control" 
                     id="message" 
                     placeholder="Message" 
                     v-model="message"
                     @keyup.enter="send">
              <div class="input-group-prepend">
                <button class="btn btn-primary" 
                        @click="send"
                        @keyup.enter="send">Send</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" 
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" 
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" 
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" 
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" 
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" 
            crossorigin="anonymous"></script>

    <script>
      /**
       * Message model for editing message 
       * @param {object} data
       */
      function MessageModel (data) {
        var self = this;

        self.id = 0;
        self.autor = data.autor ? data.autor : 'Аноним';
        self.message = data.msg ? data.msg : '';
        self.status = data.status ? data.status : false;

        /**
         * Edit message
         * @return {void}
         */
        self.edit = function () {
          alert ('Editing message by '+self.autor+', message: "'+self.message+'"');
        }
      }

      /**
       * Main app model
       */
      function MainModel () {
        var self = this;

        self.socket = io ();
        self.el = '#app';

        /**
         * Main variables by app
         */
        self.data = {
          messages: [],
          message: '',
          name: 'Аноним',
        };

        /**
         * Main methods by app
         */
        self.methods = {
          send: function () {
            let data = {
              'msg': self.data.message,
              'autor': self.data.name
            };
            self.socket.emit ('chat message', data);
            self.data.message = '';
          }
        };

        /**
         * Method sending message
         * @param  {object} data
         * @return {void}
         */
        self.socket.on ('chat message', function (data) {
          self.data.messages.push (new MessageModel (data));
          window.document.title = 'Triangle ('+self.data.messages.length+')';
        });

        /**
         * Method sending message when user disconnect
         * @return {void}
         */
        self.socket.on ('disconnect', function () {
          self.data.messages.push (new MessageModel ({
            'autor': 'System',
            'msg': 'Какой то польователь вышел',
          }));
        });

        /**
         * Method sending message when user connect
         * @return {void}
         */
        self.socket.on ('connection', function () {
          self.data.messages.push (new MessageModel ({
            'autor': 'System',
            'msg': 'Плюс один юзер',
          }));
        });
      }

      /**
       * Initialisation app
       */
      new Vue(new MainModel ());  
    </script>
  </body>
</html>